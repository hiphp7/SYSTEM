<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>脚本专栏-PHP更新文章时同时更新对应的HTML页面</title>
<META name=keywords content="">
<meta name="description" content="">
<link href="/ceshi/image/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<table width="1000" border="0" align="center" cellpadding="0"
		cellspacing="0">
		<tr>
			<td width="196"><img src="/ceshi/image/xxcms_logo.jpg"
				width="196" height="73"></td>
			<td width="616" align="center"><img
				src="/ceshi/image/xxcms_ad.jpg" width="540" height="73"></td>
			<td width="188"><table width="90%" border="0" align="right"
					cellpadding="0" cellspacing="0">
					<tr>
						<td width="49%" align="center">[<a href="/ceshi/index.php"
							class="xx_menu_top">返回首页 </a>]
						</td>
						<td width="51%" align="center">［<a
							href="/ceshi/group/2.html" target="_blank" class="xx_menu_top">版权声明</a>］
						</td>
					</tr>
					<tr>
						<td align="center">［<a href="#" class="xx_menu_top">加入收藏</a>］
						</td>
						<td align="center">［<a href="/ceshi/group/3.html"
							target="_blank" class="xx_menu_top">网站地图</a>］
						</td>
					</tr>
					<tr>
						<td align="center">［<a href="/ceshi/group/1.html"
							target="_blank" class="xx_menu_top">关于我们</a>］
						</td>
						<td align="center">［<a href="/ceshi/group/4.html"
							target="_blank" class="xx_menu_top">联系我们</a>］
						</td>
					</tr>
				</table></td>
		</tr>
	</table>
	<table width="1000" border="0" align="center" cellpadding="0"
		cellspacing="0" class="menu">
		<tr>
			<td width="10" align="left"
				background="/ceshi/image/xxcms_bg_menu.jpg"><img
				src="/ceshi/image/xxcms_left_menu.jpg" width="8" height="60"></td>
			<td width="979" align="center" valign="middle"
				background="/ceshi/image/xxcms_bg_menu.jpg"><script
					type="text/javascript"
					src="/ceshi/include/Function.php?action=menu2"></script></td>
			<td width="11" align="right"
				background="/ceshi/image/xxcms_bg_menu.jpg"><img
				src="/ceshi/image/xxcms_right_menu.jpg" width="8" height="60"></td>
		</tr>
	</table>
	<table width="1000" border="0" align="center" cellpadding="0"
		cellspacing="0">
		<tr>
			<td height="5"></td>
		</tr>
	</table>
	<table width="1000" border="0" align="center" cellpadding="0"
		cellspacing="0">
		<tr>
			<td width="230" height="192" align="center" valign="top"><table
					width="100%" border="0" cellpadding="0" cellspacing="0"
					class="xxcms_border">
					<tr>
						<td height="26" background="/ceshi/image/xxcms_hdp.jpg"
							class="xxcms_title">&nbsp;&nbsp;&nbsp;最新文章</td>
					</tr>
					<tr>
						<td><table width="100%" height="28" border="0" align="center"
								cellpadding="0" cellspacing="0">
								<script type="text/javascript"
									src="/ceshi/include/Function.php?action=zx"></script>
							</table></td>
					</tr>
				</table>
				<table width="100%" border="0" align="center" cellpadding="0"
					cellspacing="0">
					<tr>
						<td height="3"></td>
					</tr>
				</table>
				<table width="100%" border="0" cellpadding="0" cellspacing="0"
					class="xxcms_border">
					<tr>
						<td height="26" background="/ceshi/image/xxcms_hdp.jpg"
							class="xxcms_title">&nbsp;&nbsp;&nbsp;推荐文章</td>
					</tr>
					<tr>
						<td><table width="100%" height="28" border="0" align="center"
								cellpadding="0" cellspacing="0">
								<script type="text/javascript"
									src="/ceshi/include/Function.php?action=tj"></script>
							</table></td>
					</tr>
				</table>
				<table width="100%" border="0" align="center" cellpadding="0"
					cellspacing="0">
					<tr>
						<td height="3"></td>
					</tr>
				</table>
				<table width="100%" border="0" cellpadding="0" cellspacing="0"
					class="xxcms_border">
					<tr>
						<td height="26" background="/ceshi/image/xxcms_hdp.jpg"
							class="xxcms_title">&nbsp;&nbsp;&nbsp;点击排行</td>
					</tr>
					<tr>
						<td><table width="100%" height="28" border="0" align="center"
								cellpadding="0" cellspacing="0">
								<script type="text/javascript"
									src="/ceshi/include/Function.php?action=hits"></script>
							</table></td>
					</tr>
				</table></td>
			<td align="center" valign="top"><table width="99%" height="560"
					border="0" align="right" cellpadding="0" cellspacing="0"
					class="xxcms_border">
					<tr>
						<td height="414" valign="top"><table width="100%" border="0"
								align="center" cellpadding="0" cellspacing="0">
								<tr>
									<td width="39" height="26" align="center"
										background="/ceshi/image/xxcms_bg_t.jpg"><img
										src="/ceshi/image/xxcms_arr.jpg" width="16" height="22"></td>
									<td align="left" background="/ceshi/image/xxcms_bg_t.jpg"
										class="xxcms_title">脚本专栏</td>
								</tr>
							</table>

							<table width="98%" border="0" align="center" cellpadding="0"
								cellspacing="0">
								<tr>
									<td height="30" align="center" valign="middle"><strong>PHP更新文章时同时更新对应的HTML页面</strong></td>
								</tr>
								<tr>
									<td height="30" align="center" valign="middle">来源：夏日博客
										点击次数： <script type="text/javascript"
											src="/ceshi/include/Function.php?action=dj&num=10"></script>
										发布时间：2013-01-15 22:12:41
									</td>
								</tr>
								<tr>
									<td align="left" valign="middle"><P>&nbsp;&nbsp;&nbsp; 编辑文章时应该将其对应的Html静页面同时进行更新，下面来看一下“PHP更新文章时同时更新对应的Html页面”的思路，大致是这样的，执行的程序首先要将字段接受过来，这里有一个关键是有一个字段是保存Html的路径，接受过来之后，再将对应的模板打开，进行新内容的替换，重新生成Html。</P>
<P><A title=在新窗口打开图片 href="http://www.60ie.net/download.asp?id=168" target=_blank></A></P>
<P>下面是编辑时的执行程序：</P>
<P>&lt;?php<BR>if($_SESSION["admin"]&lt;&gt;session_id())<BR>{<BR>header("location:admin.php");<BR>}<BR>require_once("../inc/conn.php");<BR>$id=$_GET["id"];<BR>if($_POST["Submit"])<BR>{<BR>$title=$_POST["title"];<BR>$typeid=$_POST["typ"];<BR>$sql="select * from newstype where newstypeid=$typeid";<BR>$rs=mysql_query($sql);<BR>$rows=mysql_fetch_assoc($rs);<BR>$type=$rows["newstype"];<BR>$content=$_POST["d_content"];<BR>$source=$_POST["source"];<BR>$path=$_POST["path"];<BR>$time=$_POST["time"];<BR>$root=$_SERVER['DOCUMENT_ROOT'];<BR>$filepath="$root/newslist/$path";<BR>if(file_exists($filepath))<BR>{<BR>$moban="$root/moban/moban.html";<BR>$fp=fopen($moban,"r");<BR>$str=fread($fp,filesize($moban));<BR>fclose($fp);<BR>$str=str_replace("{-type-}",$type,$str);<BR>$str=str_replace("-title-",$title,$str);<BR>$str=str_replace("-time-",$time,$str);<BR>$str=str_replace("-content-",$content,$str);<BR>$str=str_replace("-source-",$source,$str);<BR>$fp=fopen($filepath,"w");<BR>fwrite($fp,$str);<BR>fclose($fp);<BR>}<BR>$sql="update newscontent set newstypeid=$typeid,newstitle='$title',newssource='$source' where newsid=$id";<BR>if(mysql_query($sql))<BR>{<BR>?&gt;<BR>&lt;h2 style="color:#FF0000" align="center"&gt;修改成功&lt;/h2&gt;<BR>&lt;h3 align="center"&gt;&lt;a href="admin.php"&gt;返回&lt;/a&gt;&lt;/h3&gt;<BR>&lt;?php<BR>}<BR>else<BR>{<BR>?&gt;<BR>&lt;h2 style="color:#009900" align="center"&gt;修改失败&lt;/h2&gt;<BR>&lt;h3 align="center"&gt;&lt;a href="admin.php"&gt;返回&lt;/a&gt;&lt;/h3&gt;<BR>&lt;?php<BR>}<BR>die();<BR>}<BR>?&gt;</P>
<P>&nbsp;&nbsp;&nbsp; 其实只要想明白其中的原理了，也就不难理解了。刚开始的 if 语句不用管，是一个验证是否登陆的语句，如果没有admin的值，会跳转到 admin.php页面(上次发的源码里面没有这一句，这次加上了),require_once("../inc/conn.php");这句就是包含数据库连接的文件。$id=$_GET["id"];这个就是接受过来的新闻ID，一定要有这句，否则找不到要更新哪篇文章，下面的if语句就是当Submit接受的不为空的时候，将进行文章更新操作，数据库里面的更新好理解，只要有一条Updata语句即可，这里的关键在于中间的 if(file_exists($filepath)) 和下面执行的句子了，这里的意思是判断文章的路径是不是存在，如果存在的话就进行更新替换对应的html操作。进行替换这里依然用的是str_replace的函数。这些进行完以后，下面就有一个判断是否修改成功，很简单就不再阐述了。</P></td>
								</tr>
							</table></td>
					</tr>
				</table></td>
		</tr>
	</table>
	<table width="1000" border="0" align="center" cellpadding="0"
		cellspacing="0">
		<tr>
			<td height="5"></td>
		</tr>
	</table>
	<table width="1000" border="0" align="center" cellpadding="0"
		cellspacing="0" bgcolor="#DCDCDC">
		<tr>
			<td height="1"></td>
		</tr>
	</table>
	<table width="1000" border="0" align="center" cellpadding="0"
		cellspacing="0">
		<tr>
			<td height="60" align="center"><script type="text/javascript"
					src="/ceshi/include/Function.php?action=copyright"></script></td>
		</tr>
	</table>
</body>
</html>
